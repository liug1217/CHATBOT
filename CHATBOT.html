<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=440, user-scalable=no, viewport-fit=cover">
    <title>AI Core 3.0 - æŒä¹…é€²åŒ–ç‰ˆ</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        :root { --ai-primary: #007AFF; --glass-bg: rgba(255,255,255,0.9); }
        body { margin: 0; background: #1c1c1e; display: flex; justify-content: center; font-family: -apple-system, sans-serif; }
        .app-shell { width: 440px; height: 95vh; background: #f2f2f7; margin-top: 2.5vh; display: flex; flex-direction: column; border-radius: 30px; overflow: hidden; box-shadow: 0 20px 60px rgba(0,0,0,0.4); }
        
        /* é ‚éƒ¨è³‡è¨Šï¼šé¡¯ç¤ºæŒä¹…åŒ–ç‹€æ…‹ */
        .info-bar { background: #333; color: #00FF41; padding: 8px 15px; font-family: monospace; font-size: 11px; display: flex; justify-content: space-between; }
        
        .chat-area { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 12px; }
        .msg { max-width: 80%; padding: 12px 18px; border-radius: 20px; font-size: 15px; line-height: 1.5; position: relative; animation: pop 0.3s ease; }
        @keyframes pop { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        
        .ai { background: white; align-self: flex-start; border-bottom-left-radius: 4px; color: #1c1c1e; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .user { background: var(--ai-primary); color: white; align-self: flex-end; border-bottom-right-radius: 4px; }
        
        /* æ‰“å­—æ©Ÿç‰¹æ•ˆæ¸¸æ¨™ */
        .typing::after { content: '|'; animation: blink 0.8s infinite; }
        @keyframes blink { 50% { opacity: 0; } }

        .input-box { padding: 20px; background: white; display: flex; align-items: center; gap: 12px; border-top: 1px solid #ddd; }
        input { flex: 1; border: none; background: #e9e9eb; padding: 12px 20px; border-radius: 25px; outline: none; font-size: 16px; }
        .btn-circle { width: 40px; height: 40px; background: var(--ai-primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; }
    </style>
</head>
<body>

<div class="app-shell">
    <div class="info-bar">
        <span id="storage-status">ğŸ’¾ LocalStorage: Active</span>
        <span id="token-count">Tokens: 0</span>
    </div>

    <div class="chat-area" id="display">
        </div>

    <div class="input-box">
        <input type="text" id="user-in" placeholder="è©¦è©¦è¼¸å…¥ã€Œç®—1+1ã€æˆ–ã€ŒçŒœæ•¸å­—ã€" autocomplete="off">
        <div class="btn-circle" onclick="handleInput()">
            <i class="material-icons">arrow_upward</i>
        </div>
    </div>
</div>

<script>
    // 1. æ“´å±• Token å­—å…¸
    const VOCAB = {
        "å“ˆ": 36452, "å›‰": "1746,235", "ä½ ": 12942, "å¥½": 8021,
        "ç®—": 5566, "çŒœ": 7788, "å¤©": 9901, "æ°£": 9902
    };

    // 2. åˆå§‹åŒ–æŒä¹…è¨˜æ†¶
    let memory = JSON.parse(localStorage.getItem('ai_memory')) || { history: [], userName: "ç”¨æˆ¶", gameActive: false, targetNum: 0 };

    window.onload = () => {
        const welcome = memory.history.length > 0 ? `æ­¡è¿å›ä¾†ï¼æˆ‘å€‘ä¸Šæ¬¡èŠåˆ°ï¼š${memory.history.slice(-1)[0].text}` : "æ‚¨å¥½ï¼æˆ‘æ˜¯é€²åŒ–å¾Œçš„ AI Core 3.0ã€‚æˆ‘ç¾åœ¨æ“æœ‰æŒä¹…è¨˜æ†¶ï¼Œä¸¦èƒ½åŸ·è¡Œç°¡å–®æŒ‡ä»¤ã€‚";
        addMsg(welcome, 'ai');
        updateStatus();
    };

    function handleInput() {
        const input = document.getElementById('user-in');
        const text = input.value.trim();
        if (!text) return;

        addMsg(text, 'user');
        input.value = '';
        
        // æ•¸æ“šåŒ–
        const tokens = Array.from(text).map(c => VOCAB[c] || 0);
        saveMemory(text, 'user');

        // AI æ„åœ–åˆ†æèˆ‡å‹•æ…‹å›è¦†
        setTimeout(() => processLogic(text, tokens), 600);
    }

    function processLogic(text, tokens) {
        let reply = "";
        
        // --- è·¯ç”± 1: æŒ‡ä»¤åŸ·è¡Œ (å°éŠæˆ²) ---
        if (text.includes("çŒœæ•¸å­—") || tokens.includes(7788)) {
            memory.gameActive = true;
            memory.targetNum = Math.floor(Math.random() * 10) + 1;
            reply = "ğŸ® éŠæˆ²é–‹å§‹ï¼æˆ‘å¿ƒä¸­æƒ³äº†ä¸€å€‹ 1 åˆ° 10 çš„æ•¸å­—ï¼Œä½ çŒœæ˜¯å¤šå°‘ï¼Ÿ";
        } 
        else if (memory.gameActive && !isNaN(text)) {
            const guess = parseInt(text);
            if (guess === memory.targetNum) {
                reply = "ğŸ‰ ç­”å°äº†ï¼ä½ å¤ªå²å®³äº†ã€‚éŠæˆ²çµæŸã€‚";
                memory.gameActive = false;
            } else {
                reply = guess > memory.targetNum ? "å¤ªå¤§äº†ï¼Œå†è©¦ä¸€æ¬¡ï¼" : "å¤ªå°äº†ï¼Œå†è©¦ä¸€æ¬¡ï¼";
            }
        }
        // --- è·¯ç”± 2: æŒ‡ä»¤åŸ·è¡Œ (ç°¡å–®è¨ˆç®—) ---
        else if (text.includes("ç®—") || tokens.includes(5566)) {
            try {
                const expr = text.replace(/[^\d+\-*/().]/g, '');
                reply = `ğŸ”¢ è¨ˆç®—çµæœæ˜¯ï¼š${eval(expr)}ã€‚é€™å°æˆ‘ä¾†èªªå°èœä¸€ç¢Ÿï¼`;
            } catch {
                reply = "è¨ˆç®—æ ¼å¼å¥½åƒä¸å°å–”ï¼Œè«‹è¼¸å…¥å¦‚ã€Œç®— 5*5ã€ã€‚";
            }
        }
        // --- è·¯ç”± 3: ä¸Šä¸‹æ–‡é–’èŠ ---
        else if (tokens.includes(36452) || tokens.includes(8021)) {
            const greets = ["æ‚¨å¥½ï¼è¨˜å¾—æˆ‘å€‘æ˜¯å¥½æœ‹å‹å°å§ï¼ŸğŸ¤", "å“ˆå›‰ï¼ä»Šå¤©çš„å¿ƒæƒ…çœ‹èµ·ä¾†ä¸éŒ¯å–”ï¼", "ä½ å¥½ï¼å¾ˆé«˜èˆˆä½ åˆæ‰¾æˆ‘èŠå¤©äº†ã€‚âœ¨"];
            reply = greets[Math.floor(Math.random() * greets.length)];
        }
        // --- è·¯ç”± 4: æœªçŸ¥è™•ç† ---
        else {
            reply = "é€™è¶…å‡ºäº†æˆ‘çš„ Token ç¯„åœï¼Œä½†æˆ‘å·²ç¶“è¨˜åœ¨è…¦å­è£¡äº†ã€‚ğŸ§ ";
        }

        addMsg(reply, 'ai', true);
        saveMemory(reply, 'ai');
        updateStatus();
    }

    function addMsg(txt, cl, typing = false) {
        const d = document.getElementById('display');
        const b = document.createElement('div');
        b.className = `msg ${cl} ${typing ? 'typing' : ''}`;
        d.appendChild(b);

        if (typing) {
            let i = 0;
            const timer = setInterval(() => {
                b.innerText += txt[i];
                i++;
                if (i >= txt.length) {
                    clearInterval(timer);
                    b.classList.remove('typing');
                }
                d.scrollTop = d.scrollHeight;
            }, 30);
        } else {
            b.innerText = txt;
            d.scrollTop = d.scrollHeight;
        }
    }

    function saveMemory(text, role) {
        memory.history.push({ role, text });
        if (memory.history.length > 20) memory.history.shift();
        localStorage.setItem('ai_memory', JSON.stringify(memory));
    }

    function updateStatus() {
        document.getElementById('token-count').innerText = `History: ${memory.history.length}`;
    }
</script>

</body>
</html>
